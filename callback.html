import React, { useState } from 'react';
import { Copy, Check, ExternalLink, Github } from 'lucide-react';

export default function FacebookOAuthApp() {
  const [copied, setCopied] = useState('');

  const appId = '801906149478670';
  const redirectUri = 'https://xojikabar.github.io/facebook_test/callback.html';
  const scope = 'pages_show_list,pages_read_engagement,pages_manage_metadata,pages_read_user_content';
  
  const oauthUrl = `https://www.facebook.com/v19.0/dialog/oauth?client_id=${appId}&redirect_uri=${encodeURIComponent(redirectUri)}&state=${Math.random().toString(36).substring(7)}&scope=${scope}&response_type=code`;

  const copyToClipboard = (text, key) => {
    navigator.clipboard.writeText(text);
    setCopied(key);
    setTimeout(() => setCopied(''), 2000);
  };

  const indexHtml = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook OAuth Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 100%;
        }
        h1 {
            color: #1877f2;
            margin-bottom: 10px;
            font-size: 28px;
        }
        p {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .btn {
            background: #1877f2;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        .btn:hover {
            background: #166fe5;
        }
        .info {
            margin-top: 30px;
            padding: 20px;
            background: #f0f2f5;
            border-radius: 8px;
            font-size: 14px;
            color: #555;
        }
        .info strong {
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Facebook OAuth Test</h1>
        <p>Click the button below to authenticate with Facebook and grant permissions to access your pages.</p>
        
        <a href="callback.html?code=test_mode" class="btn">
            Connect with Facebook
        </a>
        
        <div class="info">
            <strong>üìã What this does:</strong><br>
            This will redirect you to Facebook to authorize the app. After authorization, you'll be redirected back to the callback page with an access code.
        </div>
    </div>
    
    <script>
        // In production, use the real OAuth URL
        document.querySelector('.btn').addEventListener('click', function(e) {
            if (confirm('Ready to connect with Facebook? You will be redirected to Facebook for authentication.')) {
                const oauthUrl = 'https://www.facebook.com/v19.0/dialog/oauth?' + 
                    'client_id=${appId}&' +
                    'redirect_uri=' + encodeURIComponent('https://xojikabar.github.io/facebook_test/callback.html') + '&' +
                    'state=' + Math.random().toString(36).substring(7) + '&' +
                    'scope=pages_show_list,pages_read_engagement,pages_manage_metadata,pages_read_user_content&' +
                    'response_type=code';
                window.location.href = oauthUrl;
            }
            e.preventDefault();
        });
    </script>
</body>
</html>`;

  const callbackHtml = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OAuth Callback - Facebook</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
        }
        h1 {
            color: #1877f2;
            margin-bottom: 20px;
            font-size: 28px;
        }
        .status {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #f0f2f5;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .code-block {
            background: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
            word-break: break-all;
        }
        .label {
            font-weight: 600;
            color: #333;
            margin-top: 15px;
            margin-bottom: 5px;
        }
        .btn {
            background: #1877f2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.3s;
        }
        .btn:hover {
            background: #166fe5;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1877f2;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê OAuth Callback Handler</h1>
        <div id="content">
            <div class="loader"></div>
            <p style="text-align: center; color: #666;">Processing OAuth response...</p>
        </div>
    </div>

    <script>
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                code: params.get('code'),
                state: params.get('state'),
                error: params.get('error'),
                error_description: params.get('error_description')
            };
        }

        function displayResults() {
            const params = getUrlParams();
            const content = document.getElementById('content');

            if (params.error) {
                content.innerHTML = \`
                    <div class="status error">
                        <strong>‚ùå Authentication Failed</strong>
                        <p style="margin-top: 10px;">\${params.error_description || params.error}</p>
                    </div>
                    <div class="info">
                        <strong>Error Details:</strong>
                        <div class="label">Error Code:</div>
                        <div class="code-block">\${params.error}</div>
                    </div>
                    <button class="btn" onclick="window.location.href='index.html'">Try Again</button>
                \`;
            } else if (params.code) {
                content.innerHTML = \`
                    <div class="status success">
                        <strong>‚úÖ Authentication Successful!</strong>
                        <p style="margin-top: 10px;">You have successfully authorized the application.</p>
                    </div>
                    
                    <div class="info">
                        <strong>üì¶ OAuth Response Data:</strong>
                        
                        <div class="label">Authorization Code:</div>
                        <div class="code-block">\${params.code}</div>
                        
                        <div class="label">State Parameter:</div>
                        <div class="code-block">\${params.state || 'N/A'}</div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border: 1px solid #ffeaa7;">
                            <strong>‚ö†Ô∏è Next Steps:</strong>
                            <p style="margin-top: 10px; color: #856404; font-size: 14px;">
                                This authorization code must be exchanged for an access token on your backend server. 
                                Send this code to your server along with your app secret to get the access token.
                            </p>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="window.location.href='index.html'">Return to Home</button>
                \`;
                
                // You can send this to your backend here
                console.log('Authorization Code:', params.code);
                console.log('State:', params.state);
                
                // Example: Send to your backend
                // fetch('YOUR_BACKEND_URL/oauth/callback', {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify({ code: params.code, state: params.state })
                // });
            } else {
                content.innerHTML = \`
                    <div class="status error">
                        <strong>‚ö†Ô∏è No OAuth Parameters Found</strong>
                        <p style="margin-top: 10px;">This page should be accessed via Facebook OAuth redirect.</p>
                    </div>
                    <button class="btn" onclick="window.location.href='index.html'">Go to Home</button>
                \`;
            }
        }

        // Process the OAuth response when page loads
        setTimeout(displayResults, 500);
    </script>
</body>
</html>`;

  const privacyPolicyHtml = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Privacy Policy - Facebook Test App</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            color: #333;
        }
        h1 {
            color: #1877f2;
            margin-bottom: 10px;
        }
        h2 {
            color: #444;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        p {
            margin-bottom: 15px;
        }
        .date {
            color: #666;
            font-size: 14px;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <h1>Privacy Policy</h1>
    <p class="date">Last Updated: November 2025</p>
    
    <h2>1. Information We Collect</h2>
    <p>This application is a test/demo application for Facebook OAuth integration. We collect minimal information necessary for authentication:</p>
    <ul>
        <li>Facebook User ID</li>
        <li>Public profile information</li>
        <li>Page access permissions (if granted)</li>
    </ul>
    
    <h2>2. How We Use Your Information</h2>
    <p>The information collected is used solely for:</p>
    <ul>
        <li>Authentication and authorization purposes</li>
        <li>Testing Facebook API integration</li>
        <li>Development and debugging</li>
    </ul>
    
    <h2>3. Data Storage</h2>
    <p>This is a test application. We do not permanently store any personal data. All data is used temporarily for testing purposes only.</p>
    
    <h2>4. Data Sharing</h2>
    <p>We do not share, sell, or distribute your information to third parties.</p>
    
    <h2>5. Your Rights</h2>
    <p>You can revoke this application's access at any time through your Facebook Settings ‚Üí Apps and Websites.</p>
    
    <h2>6. Contact</h2>
    <p>For questions about this privacy policy, please contact: hojakbarmadaminov45@gmail.com</p>
</body>
</html>`;

  const readmeMd = `# Facebook OAuth Test Application

This is a test application for Facebook OAuth integration.

## Setup Instructions

### 1. Configure Facebook App

Go to your Meta Developer Dashboard and configure:

- **Application ID**: ${appId}
- **Application domains**: \`xojikabar.github.io\`
- **Privacy Policy URL**: \`https://xojikabar.github.io/facebook_test/privacy-policy.html\`
- **User Agreement URL**: \`https://xojikabar.github.io/facebook_test/privacy-policy.html\`

### 2. OAuth URL

Use this URL to initiate OAuth flow:

\`\`\`
${oauthUrl}
\`\`\`

### 3. Files

- **index.html** - Main page with login button
- **callback.html** - OAuth callback handler
- **privacy-policy.html** - Privacy policy page

### 4. Testing

1. Open \`https://xojikabar.github.io/facebook_test/\`
2. Click "Connect with Facebook"
3. Authorize the app
4. View the authorization code in the callback page

### 5. Next Steps

Exchange the authorization code for an access token on your backend:

\`\`\`javascript
const response = await fetch('https://graph.facebook.com/v19.0/oauth/access_token', {
  method: 'GET',
  params: {
    client_id: '${appId}',
    client_secret: 'YOUR_APP_SECRET',
    code: 'AUTHORIZATION_CODE_FROM_CALLBACK',
    redirect_uri: '${redirectUri}'
  }
});
\`\`\`

## Security Note

‚ö†Ô∏è Never expose your App Secret in client-side code. Always exchange tokens on your backend server.
`;

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
      <div className="max-w-4xl mx-auto">
        <div className="bg-white rounded-2xl shadow-xl p-8">
          <div className="flex items-center gap-3 mb-6">
            <div className="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center">
              <Github className="w-7 h-7 text-white" />
            </div>
            <div>
              <h1 className="text-3xl font-bold text-gray-900">Facebook OAuth Setup</h1>
              <p className="text-gray-600">Complete GitHub Pages deployment files</p>
            </div>
          </div>

          {/* OAuth URL */}
          <div className="mb-8 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200">
            <div className="flex items-center justify-between mb-3">
              <h2 className="text-lg font-semibold text-gray-900 flex items-center gap-2">
                <ExternalLink className="w-5 h-5 text-blue-600" />
                Your OAuth URL
              </h2>
              <button
                onClick={() => copyToClipboard(oauthUrl, 'oauth')}
                className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium"
              >
                {copied === 'oauth' ? <Check className="w-4 h-4" /> : <Copy className="w-4 h-4" />}
                {copied === 'oauth' ? 'Copied!' : 'Copy'}
              </button>
            </div>
            <div className="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm font-mono">
              {oauthUrl}
            </div>
          </div>

          {/* Files to Create */}
          <div className="space-y-6">
            <h2 className="text-2xl font-bold text-gray-900 mb-4">üìÅ Files to Deploy</h2>

            {/* index.html */}
            <FileCard
              title="index.html"
              description="Main landing page with Facebook login"
              content={indexHtml}
              copied={copied}
              onCopy={copyToClipboard}
              fileKey="index"
            />

            {/* callback.html */}
            <FileCard
              title="callback.html"
              description="OAuth callback handler"
              content={callbackHtml}
              copied={copied}
              onCopy={copyToClipboard}
              fileKey="callback"
            />

            {/* privacy-policy.html */}
            <FileCard
              title="privacy-policy.html"
              description="Privacy policy page"
              content={privacyPolicyHtml}
              copied={copied}
              onCopy={copyToClipboard}
              fileKey="privacy"
            />

            {/* README.md */}
            <FileCard
              title="README.md"
              description="Documentation and setup instructions"
              content={readmeMd}
              copied={copied}
              onCopy={copyToClipboard}
              fileKey="readme"
            />
          </div>

          {/* Deployment Instructions */}
          <div className="mt-8 p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200">
            <h3 className="text-xl font-bold text-gray-900 mb-4">üöÄ Deployment Steps</h3>
            <ol className="space-y-3 text-gray-700">
              <li className="flex gap-3">
                <span className="font-bold text-green-600">1.</span>
                <span>Create a new repository or use existing <code className="px-2 py-1 bg-white rounded">facebook_test</code></span>
              </li>
              <li className="flex gap-3">
                <span className="font-bold text-green-600">2.</span>
                <span>Copy each file content above and create the files in your repo</span>
              </li>
              <li className="flex gap-3">
                <span className="font-bold text-green-600">3.</span>
                <span>Go to Settings ‚Üí Pages ‚Üí Enable GitHub Pages from main branch</span>
              </li>
              <li className="flex gap-3">
                <span className="font-bold text-green-600">4.</span>
                <span>Update your Meta app settings with the callback URL</span>
              </li>
              <li className="flex gap-3">
                <span className="font-bold text-green-600">5.</span>
                <span>Test at: <code className="px-2 py-1 bg-white rounded">https://xojikabar.github.io/facebook_test/</code></span>
              </li>
            </ol>
          </div>

          {/* Meta App Settings */}
          <div className="mt-8 p-6 bg-yellow-50 rounded-xl border border-yellow-200">
            <h3 className="text-xl font-bold text-gray-900 mb-4">‚öôÔ∏è Meta App Settings to Update</h3>
            <div className="space-y-3 text-sm">
              <div>
                <span className="font-semibold text-gray-700">Application domains:</span>
                <code className="ml-2 px-2 py-1 bg-white rounded">xojikabar.github.io</code>
              </div>
              <div>
                <span className="font-semibold text-gray-700">Privacy Policy URL:</span>
                <code className="ml-2 px-2 py-1 bg-white rounded text-xs">https://xojikabar.github.io/facebook_test/privacy-policy.html</code>
              </div>
              <div>
                <span className="font-semibold text-gray-700">Upload App Icon:</span>
                <span className="ml-2 text-gray-600">1024√ó1024 PNG image</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

function FileCard({ title, description, content, copied, onCopy, fileKey }) {
  const [expanded, setExpanded] = useState(false);

  return (
    <div className="border border-gray-200 rounded-xl overflow-hidden hover:border-blue-300 transition-colors">
      <div className="bg-gray-50 p-4 flex items-center justify-between">
        <div className="flex-1">
          <h3 className="font-semibold text-gray-900">{title}</h3>
          <p className="text-sm text-gray-600">{description}</p>
        </div>
        <div className="flex gap-2">
          <button
            onClick={() => setExpanded(!expanded)}
            className="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium"
          >
            {expanded ? 'Hide' : 'View'}
          </button>
          <button
            onClick={() => onCopy(content, fileKey)}
            className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium"
          >
            {copied === fileKey ? <Check className="w-4 h-4" /> : <Copy className="w-4 h-4" />}
            {copied === fileKey ? 'Copied!' : 'Copy'}
          </button>
        </div>
      </div>
      {expanded && (
        <div className="bg-gray-900 p-4 overflow-x-auto">
          <pre className="text-gray-100 text-xs font-mono">{content}</pre>
        </div>
      )}
    </div>
  );
}
